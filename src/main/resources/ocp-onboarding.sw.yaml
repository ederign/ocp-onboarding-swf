---
specVersion: 0.8
id: ocpob
name: Onboarding to OCP
annotations:
  - "workflow-type/infrastructure"
version: 0.0.1
timeouts:
  workflowExecTimeout: PT24H
start: CreateJiraIssue
dataInputSchema: ocpob-schema.json
functions:
  - name: getJiraIssue
    operation: specs/jira.yml#getIssue
  - name: createJiraIssue
    operation: specs/jira.yml#createIssue
states:
  - name: CreateJiraIssue
    type: operation
    actions:
      - functionRef:
          refName: createJiraIssue
          arguments:
            update: {}
            fields:
              summary: "Create an OpenShift namespace by name .namespace for developer"
              issuetype:
                id: "10001"
              project:
                id: "10000"
        actionDataFilter:
          toStateData: .jiraIssue
    stateDataFilter:
      output: "{jiraIssue: .jiraIssue, status: .jiraIssue.fields.status.name}"
    transition: GetJiraIssue

  - name: GetJiraIssue
    type: operation
    actions:
      - functionRef:
          refName: getJiraIssue
          arguments:
            issueIdOrKey: .jiraIssue.key
            fields: status
        actionDataFilter:
          toStateData: .jiraIssue
    stateDataFilter:
      output: "{jiraIssue: .jiraIssue, status: .jiraIssue.fields.status.name}"
    end: true

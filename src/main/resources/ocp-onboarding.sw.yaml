---
specVersion: 0.8
id: ocpob
name: Onboarding to OCP
annotations:
  - "workflow-type/infrastructure"
version: 0.0.1
timeouts:
  workflowExecTimeout: PT24H
start: CreateK8sNamespace
dataInputSchema: ocpob-schema.json
functions:
  - name: getJiraIssue
    operation: specs/jira.yml#getIssue
  - name: createJiraIssue
    operation: specs/jira.yml#createIssue
  - name: createK8sNamespace
    operation: specs/kube.yaml#createCoreV1Namespace

states:
  - name: CreateK8sNamespace
    type: operation
    actions:
      - functionRef:
          refName: createK8sNamespace
          arguments:
            apiVersion: v1
            kind: Namespace
            metadata:
              name: ".namespace"
        actionDataFilter:
          toStateData: .createdNamespace
    stateDataFilter:
      output: "{createdNamespace: .createdNamespace}"
    end: true
#  - name: CreateJiraIssue
#    type: operation
#    actions:
#      - functionRef:
#          refName: createJiraIssue
#          arguments:
#            update: {}
#            fields:
#              summary: "Create an OpenShift namespace by name .namespace for developer"
#              issuetype:
#                id: "10001"
#              project:
#                id: "10000"
#        actionDataFilter:
#          toStateData: .jiraIssue
#    stateDataFilter:
#      output: "{jiraIssue: .jiraIssue, status: .jiraIssue.fields.status.name}"
#    transition: GetJiraIssue
#
#  - name: GetJiraIssue
#    type: operation
#    actions:
#      - functionRef:
#          refName: getJiraIssue
#          arguments:
#            issueIdOrKey: .jiraIssue.key
#            fields: status
#        actionDataFilter:
#          toStateData: .jiraIssue
#    stateDataFilter:
#      output: "{jiraIssue: .jiraIssue, status: .jiraIssue.fields.status.name}"
#    end: true
